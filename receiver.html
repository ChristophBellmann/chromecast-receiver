<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Low-Latency Receiver v0.1</title>
    <!-- 1) Load the Web Receiver SDK -->
    <script src="https://www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <style>
      /* Full-screen black bg */
      html, body {
        margin:0; padding:0; width:100%; height:100%;
        background:black; overflow:hidden;
      }

      /* 2) Cast Media Player with custom splash */
      cast-media-player {
        width:100%; height:100%;
        --media-background-color: black; 
        /* Show this splash until we load real media */
        --media-splash-image: url('https://your-cdn.com/splash-v0.1.png');
        --media-splash-image-size: contain;
        --media-splash-image-position: center center;
        /* hide the default control bar */
        --media-control-bar-display: none;
      }

      /* 3) When native controls appear, hide the yellow bar */
      cast-media-player::part(controls-overlay) {
        background: rgba(0,0,0,0.6);
      }

      /* 4) “About” & “Info” overlays */
      .overlay {
        position:absolute; top:10%; left:10%;
        color:white; background:rgba(0,0,0,0.7);
        padding:1rem; border-radius:4px;
        display:none; z-index:200;
      }
      .overlay h2 { margin-top:0; }
    </style>
  </head>
  <body>
    <!-- The cast-managed player -->
    <cast-media-player id="player"></cast-media-player>

    <!-- Simple overlays -->
    <div id="about" class="overlay">
      <h2>About</h2>
      <p>Hi Linda! Hier ist ein selbstgebauter Player.<br/>Lieben Gruß, Christoph</p>
      <p><em>v0.1</em></p>
    </div>
    <div id="info" class="overlay">
      <h2>Info</h2>
      <pre id="stats">
Ping: -- ms
Delay: -- s
Video: --×--
Audio: AAC 192 kbps, Stereo
      </pre>
    </div>

    <script>
      const context = cast.framework.CastReceiverContext.getInstance();
      const playerManager = context.getPlayerManager();

      // 5) Only listen for the commands we care about
      context.setOptions({
        supportedCommands: [
          cast.framework.messages.CommandType.PAUSE,
          cast.framework.messages.CommandType.SEEK,
          cast.framework.messages.CommandType.STOP,
          cast.framework.messages.CommandType.BACK,
          cast.framework.messages.CommandType.STREAM_VOLUME,
          cast.framework.messages.CommandType.STREAM_MUTE
        ],
        disableIdleTimeout: true
      });

      // 6) On LOAD, capture ts= for sync, then let the native splash stay up until playing
      playerManager.setMessageInterceptor(
        cast.framework.messages.MessageType.LOAD, data => {
          const url = new URL(data.media.contentId);
          const ts  = parseInt(url.searchParams.get('ts'),10);
          if (!isNaN(ts)) {
            data.currentTime = (Date.now() - ts)/1000;
          }
          return data;
        }
      );

      // 7) Toggle About/Info with RIGHT/LEFT arrows
      document.addEventListener('keydown', e => {
        // Back or STOP hides everything
        if (e.key === 'Backspace' || e.keyCode === 10009) {
          document.getElementById('about').style.display = 'none';
          document.getElementById('info').style.display  = 'none';
        }
        // ▶ (RIGHT) shows About
        else if (e.key === 'ArrowRight') {
          document.getElementById('about').style.display = 'block';
        }
        // ◀ (LEFT) shows Info
        else if (e.key === 'ArrowLeft') {
          // update ping & delay
          fetch(playerManager.getMediaInformation().contentId, {method:'HEAD'})
            .then(() => {
              const ping = Math.round(performance.now());
              const delay = ((Date.now() - ts)/1000).toFixed(1);
              document.getElementById('stats').textContent =
                `Ping: ${ping} ms\nDelay: ${delay} s\n` +
                `Video: ${playerManager.getMediaStatus().media.metadata.width}×` +
                `${playerManager.getMediaStatus().media.metadata.height}\n` +
                `Audio: AAC 192 kbps, Stereo`;
              document.getElementById('info').style.display = 'block';
            });
        }
      });

      // 8) Start the receiver
      context.start();
    </script>
  </body>
</html>
