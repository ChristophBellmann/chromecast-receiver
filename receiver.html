<!DOCTYPE html>
<html>
<head>…same as before…</head>
<body>
  <cast-media-player id="player"></cast-media-player>
  <script>
    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();

    // Intercept the LOAD request
    playerManager.setMessageInterceptor(
      cast.framework.messages.MessageType.LOAD,
      (loadRequestData) => {
        loadRequestData.autoplay = false;  // we’ll start it manually

        // extract ?ts= from the contentId
        let url = new URL(loadRequestData.media.contentId);
        const ts = parseInt(url.searchParams.get("ts"));
        if (ts) {
          const now = Date.now();
          const offsetSec = (now - ts) / 1000;
          console.log("Sync offset (s):", offsetSec);
          loadRequestData.currentTime = offsetSec;
        }
        return loadRequestData;
      }
    );

    // once ready, actually start playback
    context.addEventListener(
      cast.framework.system.EventType.READY,
      () => {
        console.log("Receiver ready, calling load...");
        // The actual LOAD message comes automatically after start()
      }
    );

    context.start({ disableIdleTimeout: true });
  </script>
</body>
</html>
